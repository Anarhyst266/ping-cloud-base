filter {
  if ([headers][request_method] == "GET")
  {
    drop {}
  }
  de_dot {
    fields => ["[kubernetes][labels][app.kubernetes.io]", "[kubernetes][labels][app.kubernetes.io/name]", "[kubernetes][labels][app.kubernetes.io/version]", "[kubernetes][labels][app.kubernetes.io/part-of]",  "[kubernetes][labels][app.kubernetes.io/role]", "[kubernetes][labels][app.kubernetes.io/component]", "[kubernetes][labels][app.kubernetes.io/instance]"]
  }
if ([kubernetes][container_name] =~ "^ping.*" ) {
    mutate {
      replace => { "log_type" => "ping-apps" }
    }
    if ([kubernetes][container_name] == "pingdirectory") {
      if ([log] =~ "^/opt/out/instance/logs/access") {
        mutate {
          replace => { "log_type" => "PD_Access_Log" }
        }
      }
    }
  } else {
    mutate {
      rename => { "log" => "message" }
    }
  }
  if ([kubernetes][pod_name] =~ ".*healthcheck.*") {
    mutate {
      replace => {"log_group" => "healthcheck"}
      rename => {"log" => "message"}
    }
  }
  if ([kubernetes][pod_name] =~ ".*backup.*" or [kubernetes][pod_name] =~ ".*repo1.*") {
    mutate {
      replace => {"log_group" => "backup"}
      rename => {"log" => "message"}
    }
  }
}
